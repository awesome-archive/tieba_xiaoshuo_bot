<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>百度贴吧小说推送机器人 by crhan</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>百度贴吧小说推送机器人</h1>
        <p>自动抓百度贴吧置顶的小说章节更新，并推送手机版式的贴吧链接到 gtalk 客户端(理论支持所有 XMPP 聊天服务)</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/crhan/tieba_xiaoshuo_bot" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/crhan/tieba_xiaoshuo_bot/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/crhan/tieba_xiaoshuo_bot/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>Howto?</h1>

<ol>
<li><code>yum install postgresql-devel libxslt-devel postgresql-server libxml2-devel</code></li>
<li><code>bundle install</code></li>
<li>改名 <code>mv config/config.yml{.example,}</code>
</li>
<li>填上自己的信息（ <strong>数据库使用 <code>Sequel</code> 作为 ORM gem</strong> ）</li>
<li><code>rake migration</code></li>
<li><code>bundle exec foreman start</code></li>
</ol><h1>Fetch Rules?</h1>

<ul>
<li>每五分钟扫描一遍对应小说贴吧的置顶帖，如果扫到包含 <em>第xxx章</em>
字样的就认定是更新的小说章节，然后发给订阅者</li>
<li>依赖百度贴吧的“置顶贴”，严重感谢贴吧吧务们</li>
</ul><h1>Try?</h1>

<ul>
<li>用 Gtalk 加好友 <code>crhan.xiaoshuo@gmail.com</code>
</li>
<li>发送 <code>-?</code> 给机器人查看帮助</li>
<li>发送 <code>-sub 小说名字</code> 即可订阅小说</li>
</ul><h1>Commands</h1>

<ul>
<li>-c/-check: 在 <strong>被动</strong> 模式下查看积累的更新</li>
<li>-s/-sub &lt;小说名&gt;: 订阅小说(请先检查对应贴吧是否有小说更新服务)</li>
<li>-us/-unsub &lt;小说名&gt;: 退订已订阅的小说</li>
<li>-sm/-switch<em>mode: 在 __主动</em>_ 和 <strong>被动</strong> 推送模式之间切换</li>
<li>-m/-show_mode: 看看自己是在主动模式还是被动模式</li>
<li>-h/-?/-help: 查看帮助</li>
<li>-l/-ls/-list: 查看已订阅(包括已退订)的小说</li>
<li>-fb/-feedback: 给我提意见啦</li>
<li>-ab/-about: 无聊卖萌(女神提供的台词)</li>
<li>-co/-count: 看看我已经发给你多少章小说啦</li>
</ul><hr><h1>Change Log</h1>

<h2>1.3.3 / 2012-09-02</h2>

<ul>
<li>修正无法获得小说贴吧列表的问题  - 来自百度贴吧的奇怪更新, 如果在请求头中没有附带 BAIDUID 的 cookie 的话会导致 301 跳转</li>
<li>修正 unsub 的方法重构后没有对应调整 worker 方法</li>
</ul><h2>1.3.2 / 2012-08-24</h2>

<ul>
<li>恢复五分钟一次在线检测</li>
<li>修复 count 命令错误</li>
<li>百度贴吧改版, 修改DOM搜索规则</li>
</ul><h2>1.3.1 / 2012-08-16</h2>

<ul>
<li>bugs fixed</li>
</ul><h2>1.3.0 / 2012-08-14</h2>

<ul>
<li>增加 Fiction::name 的 unique 限制</li>
<li>使用 simplecov 作为测试覆盖率工具</li>
<li>分离 <em>测试</em> 和 <em>发布</em> 环境的数据库配置</li>
<li>重构 worker/send.rb, model/user.rb, model/fiction.rb</li>
<li>增加测试代码, 测试样本数据</li>
<li>修复 migration 错误</li>
</ul><h2>1.2.4 / 2012-07-31</h2>

<ul>
<li>重构 bot.rb 并添加了短命令</li>
<li>Bot 不再使用单例模式, 并且尝试掉线后自动重连并重试发送</li>
<li>handle <code>Jabber::ServerDisconnected</code> and log it</li>
<li>Error log will log the hooked user now</li>
</ul><h2>1.2.3 / 2012-07-23</h2>

<ul>
<li>切换模式命令改为 <code>-switch</code>, 查看模式为 <code>-mode</code>
</li>
</ul><h2>1.2.2 / 2012-07-21</h2>

<ul>
<li>修复无法在 send.rb 中 Subscription.update(:check_id =&gt; last_id) 的问题</li>
</ul><h2>1.2.1 / 2012-07-21</h2>

<ul>
<li>修复 worker/send.rb:45 的 send NilClass 问题</li>
</ul><h2>1.2.0 / 2012-07-20</h2>

<ul>
<li>model 的 before_create 和 before_save 改为 mixin 形式混入. 正常 model 直接继承 Sequel::Model</li>
<li>加入等待, 确保在 <code>-check</code> 时候小说按照顺序分发</li>
<li>增加 <code>check</code> 模式和 <code>-check</code> 命令 使用 <code>-mode</code> 切换模式</li>
<li>增加 <code>-count</code> 命令</li>
</ul><h2>1.1.0 / 2012-07-13</h2>

<ul>
<li>增加gtalk XMPP extension 属性, 默认保存消息历史到 gtalk 服务器</li>
</ul><h2>1.0.6 / 2012-06-26</h2>

<ul>
<li>修复 1.0.3 引入的重复章节检测的 Typo</li>
</ul><h2>1.0.5 / 2012-06-25</h2>

<ul>
<li>IQ 查询并发导致 users 重复创建, 在数据库上增加 unique 限制</li>
</ul><h2>1.0.4 / 2012-06-25</h2>

<ul>
<li>修正由于 Typo 导致的 Bot 崩溃</li>
</ul><h2>1.0.3 / 2012-06-25</h2>

<ul>
<li>章节名重复检测有误, 修正</li>
</ul><h2>1.0.2 / 2012-06-24</h2>

<ul>
<li>失误：改了 rack 的配置文件名却没改 <code>Prockfile</code> 的配置</li>
</ul><h2>1.0.1 / 2012-06-24</h2>

<ul>
<li>gtalk 密码分离到 config/config.yml 配置文件 准备开源</li>
</ul><h2>1.0.0 / 2012-06-24</h2>

<ul>
<li>自动添加现有好友到数据库</li>
<li>检测重复章节名（一般是因为前一贴被删才有新的同名贴) 优化章节名(去除第一个“第”之前的文字，并且多个空格和并成一个)</li>
<li>增加 <code>-list</code>, <code>-sub</code>, <code>-unsub</code>, <code>-help</code>, <code>-about</code>, <code>-feedback</code> 命令</li>
<li>使用 <code>Sidekiq</code> 作为队列实现</li>
<li>使用 <code>Sequel</code> 作为 ORM 组件</li>
<li>使用 <code>PostgreSQL</code> 做数据存储</li>
<li>REXML bug fix: 使用
<a href="https://github.com/ln/xmpp4r/issues/3#issuecomment-1739952"> xmpp4r/issues/3 </a> 补丁使 REXML 能正确处理 UTF 字符</li>
</ul>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/crhan">crhan</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>